<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
      <meta name="description" content="" />
      <meta name="author" content="" />
      <title>Shop Homepage</title>
      <!-- Favicon-->
      <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
      <!-- Bootstrap icons-->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
      <!-- Core theme CSS (includes Bootstrap)-->
      <link rel="stylesheet" href="/static/css/styles.css"/>
   </head>
   {{- template "header.html" . }}
   <body>
      <!-- Navigation-->
      <!-- Header-->
      <header class="bg-dark py-5">
         <div class="container px-4 px-lg-5 my-5">
            <div class="text-center text-white">
               <h1 class="display-4 fw-bolder">Shop in style</h1>
               <p class="lead fw-normal text-white-50 mb-0">With this shop hompeage template</p>
            </div>
         </div>
      </header>
      <!-- Section-->
      <section class="py-5">
         <div class="container px-4 px-lg-5 mt-5">
            <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
               {{$Session := .Session}}
               {{if eq $Session.UserType "admin"}}
               <div class="col mb-5">
                  <div class="card h-100">
                     <!-- Product image-->
                     <div class="badge bg-dark text-white position-absolute" style="top: 0.5rem; right: 0.5rem">New product</div>
                     <img class="card-img-top w-100 h-100" src="/static/images/background.jpg" alt="..."/>
                     <!-- Product details-->
                     <div class="card-body p-4">
                        <div class="text-center">
                           <!-- Product name-->
                           <h5 class="fw-bolder">New product</h5>
                           <!-- Product price-->
                           <div class="price">New product</div>
                        </div>
                     </div>
                     <div class="text-center">
                        <a class="btn btn-outline-dark mt-2 w-100" href="/products/new">Add product</a>
                     </div>
                  </div>
               </div>
               {{end}}
               {{range .Products}}
               <div class="col mb-5">
                  <div class="card h-100">
                     <!-- Product image-->
                     <div class="badge bg-dark text-white position-absolute" style="top: 0.5rem; right: 0.5rem">{{.Tag}}</div>
                     <img class="card-img-top" src="{{.ImageURL}}" alt="..."/>
                     <!-- Product details-->
                     <div class="card-body p-4">
                        <div class="text-center">
                           <!-- Product name-->
                           <h5 class="fw-bolder">{{.Title}}</h5>
                           <!-- Product price-->
                           <div class="price">{{.Price}} rub.</div>
                        </div>
                     </div>
                     <!-- Product actions-->
                     <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                        {{if eq $Session.UserType "admin"}}
                        <span data-id="{{.ID}}" class="delete-product btn btn-outline-dark w-100">Delete</span>
                        <a class="btn btn-outline-dark mt-2 w-100" href="/products/update/{{.ID}}">Modify</a>
                     </div>
                     <div class="text-center">
                        {{else}}
                        {{if ($Session.IsPurchased .ID)}}
                        <div class="text-center">
                           <h5 class="fw-light">Added to basket!</h5>
                        </div>
                        {{else}}
                        <span data-id="{{.ID}}" class="add-to-basket btn btn-outline-dark w-100">To basket</span>
                        {{end}}
                        <a class="btn btn-outline-dark mt-2 w-100" href="/products/{{.ID}}">Check</a>
                     </div>
                     <div class="text-center">
                        {{end}}
                     </div>
                  </div>
               </div>
               {{end}}
            </div>
         </div>
      </section>
      <!-- Footer-->
      <footer class="py-5 bg-dark">
         <div class="container">
            <p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p>
         </div>
      </footer>
      <!-- Bootstrap core JS-->
      <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script> -->
      <!-- Core theme JS-->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
      <script type="text/javascript">
         $('.add-to-basket').click(function() {
           $elem = $(this)
           $.ajax({
             url: '/basket/' + $elem.data("id"),
             type: 'GET',
             data: {},
             success: function(resp) {
               if(resp.updated) {
                   $elem.hide()
                   $elem.parent().prepend(`<div class="text-center"><h5 class="fw-light">Added to basket!</h5></div>`)
               }
             },
           });
         })
      </script>
      <script type="text/javascript">
         $('.delete-product').click(function() {
           $elem = $(this)
           $.ajax({
             url: '/products/' + $elem.data("id"),
             type: 'DELETE',
             data: {},
             success: function(resp) {
               if(resp.updated) {
                 $elem.parent().parent().remove()
               }
             },
           });
         })
      </script>
   </body>
</html>